@app.post("/analyze-photo")
async def analyze_photo(request: PhotoAnalyzeRequest):
    
    if not request.image_base64:
        raise HTTPException(status_code=400, detail="Image is required")
    
    try:
        image_data = request.image_base64
        if "base64," in image_data:
            image_data = image_data.split("base64,")[1]
        
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {
                    "role": "user",
                    "content": [
                        {
                            "type": "text", 
                            "text": """–¢—ã ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ü—Ä–æ–≤–µ–¥–∏ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –∞–Ω–∞–ª–∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π.

–û—Ü–µ–Ω–∏ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –∞—Å–ø–µ–∫—Ç—ã:

üì∏ –ö–ê–ß–ï–°–¢–í–û –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø: [–æ—Ü–µ–Ω–∫–∞ 0-100]
‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏ —á–µ—Ç–∫–æ—Å—Ç—å
‚Ä¢ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∂–∞—Ç–∏—è
‚Ä¢ –®—É–º—ã

üé® –¶–í–ï–¢–û–ö–û–†–†–ï–ö–¶–ò–Ø:
‚Ä¢ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã (–∫–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏)
‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç–∏/–∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
‚Ä¢ –¶–≤–µ—Ç–æ–≤–æ–π –±–∞–ª–∞–Ω—Å

üîß –ü–†–ò–ó–ù–ê–ö–ò –†–ï–¢–£–®–ò:
‚Ä¢ –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä
‚Ä¢ –†–∞–∑–º—ã—Ç–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π
‚Ä¢ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π

ü§ñ –ü–†–ò–ó–ù–ê–ö–ò AI-–ì–ï–ù–ï–†–ê–¶–ò–ò:
‚Ä¢ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π
‚Ä¢ –ù–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
‚Ä¢ –ê–Ω–æ–º–∞–ª–∏–∏ –≤ –¥–µ—Ç–∞–ª—è—Ö

üí° –û–°–í–ï–©–ï–ù–ò–ï:
‚Ä¢ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ç–µ–Ω–µ–π
‚Ä¢ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–∞
‚Ä¢ –ü—Ä–∏–∑–Ω–∞–∫–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è

üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –í–ï–†–î–ò–ö–¢:
[–ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –æ —Å—Ç–µ–ø–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]

–î–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."""
                        },
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": f"data:image/jpeg;base64,{image_data}"
                            }
                        }
                    ]
                }
            ],
            max_tokens=1500
        )
        
        analysis = response.choices[0].message.content
        return {"analysis": analysis}
    
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))




